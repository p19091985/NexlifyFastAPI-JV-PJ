<style nonce="{{ request.scope.get('csp_nonce', '') }}">
    :root {
        /* Cores */
        --bs-primary: {{ settings.custom_colors.primary | default('#0d6efd') }};
        --bs-secondary: {{ settings.custom_colors.secondary | default('#6c757d') }};
        --bs-success: {{ settings.custom_colors.success | default('#198754') }};
        --bs-info: {{ settings.custom_colors.info | default('#0dcaf0') }};
        --bs-warning: {{ settings.custom_colors.warning | default('#ffc107') }};
        --bs-danger: {{ settings.custom_colors.danger | default('#dc3545') }};
        /* Adiciona light e dark se existirem no settings */
        {% if settings.custom_colors.light %}--bs-light: {{ settings.custom_colors.light }};{% endif %}
        {% if settings.custom_colors.dark %}--bs-dark: {{ settings.custom_colors.dark }};{% endif %}
        /* Cores RGB (usadas para opacidade e focus rings) */
        --bs-primary-rgb: {{ primary_rgb_val }};
        --bs-secondary-rgb: {{ hex_to_rgb_str(settings.custom_colors.secondary, default_rgb='108,117,125') }};
        --bs-success-rgb: {{ hex_to_rgb_str(settings.custom_colors.success, default_rgb='25,135,84') }};
        --bs-info-rgb: {{ hex_to_rgb_str(settings.custom_colors.info, default_rgb='13,202,240') }};
        --bs-warning-rgb: {{ hex_to_rgb_str(settings.custom_colors.warning, default_rgb='255,193,7') }};
        --bs-danger-rgb: {{ hex_to_rgb_str(settings.custom_colors.danger, default_rgb='220,53,69') }};
        {% if settings.custom_colors.light %}--bs-light-rgb: {{ hex_to_rgb_str(settings.custom_colors.light) }};{% endif %}
        {% if settings.custom_colors.dark %}--bs-dark-rgb: {{ hex_to_rgb_str(settings.custom_colors.dark) }};{% endif %}
        /* Ajusta cores derivadas importantes (pode precisar de mais ajustes para temas complexos) */
        --bs-link-color: var(--bs-primary);
        --bs-link-color-rgb: var(--bs-primary-rgb);
        /* Aproximação da cor hover (pode precisar de ajuste manual ou SASS) */
        --bs-link-hover-color: color-mix(in srgb, var(--bs-primary) 80%, black);
        --bs-nav-pills-link-active-bg: var(--bs-primary); /* Para sidebar ativa */
        --bs-focus-ring-color: rgba(var(--bs-primary-rgb), var(--bs-focus-ring-opacity)); /* Usa a cor primária para o foco */
        /* Bordas */
        --bs-border-width: {{ border_width_px }};
        --bs-border-radius: {{ border_radius_rem }};
        --bs-border-radius-sm: calc({{ border_radius_rem }} * 0.66);
        --bs-border-radius-lg: calc({{ border_radius_rem }} * 1.33);
        --bs-border-radius-xl: calc({{ border_radius_rem }} * 2.66);
        --bs-border-radius-xxl: calc({{ border_radius_rem }} * 5.33);
        --bs-border-radius-pill: 50rem;
         /* Foco - Desabilita se focus_ring for false */
         {% if not settings.get('focus_ring', True) %}
        --bs-focus-ring-width: 0px !important; /* Usa px para garantir zero */
        --bs-focus-ring-opacity: 0 !important;
        --bs-focus-ring-color: transparent !important;
         :focus-visible { outline: none !important; box-shadow: none !important; }
         /* Remove box-shadow padrão do bootstrap em :focus */
         .form-control:focus, .form-select:focus, .btn:focus, .accordion-button:focus, .form-check-input:focus {
            box-shadow: none !important;
            /* Pode precisar de borda alternativa se o focus ring for a única indicação */
            /* border-color: var(--bs-primary); */
         }
         /* Remove o box-shadow específico do btn-check */
        .btn-check:focus-visible+.btn { box-shadow: none !important; }
         {% endif %}
    }
    body {
        /* Aplica a fonte e tamanho base */
        font-family: {{ settings.font_family | default('system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"') }};
        font-size: {{ font_size_rem }};
         /* Ajuste line-height se necessário (Bootstrap padrão é 1.5) */
         /* line-height: 1.5; */
    }
    /* Garante que elementos de formulário e botões herdem o tamanho da fonte base */
    .form-control, .form-select, .btn, .input-group-text, .form-label {
         font-size: inherit;
    }
    /* Ajuste específico para tamanhos sm/lg se necessário */
    .form-control-sm, .btn-sm, .input-group-sm > .form-control, .input-group-sm > .input-group-text, .form-select-sm { font-size: 0.875em; }
    .form-control-lg, .btn-lg, .input-group-lg > .form-control, .input-group-lg > .input-group-text, .form-select-lg { font-size: 1.25em; }
</style>