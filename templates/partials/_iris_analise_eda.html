<div>
    <div class="row g-3">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="chart-eda-1" style="min-height: 365px;">
                        <div class="text-center p-4">
                             <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando gráfico 1...</span>
                            </div>
                         </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                 <div class="card-body">
                    <div id="chart-eda-2" style="min-height: 365px;">
                        <div class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                 <span class="visually-hidden">Carregando gráfico 2...</span>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="chart-eda-3" style="min-height: 365px;">
                         <div class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando gráfico 3...</span>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
         <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="chart-eda-4" style="min-height: 365px;">
                        <div class="text-center p-4">
                             <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando gráfico 4...</span>
                            </div>
                         </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                     <div id="chart-eda-5" style="min-height: 365px;">
                        <div class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                 <span class="visually-hidden">Carregando gráfico 5...</span>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="chart-eda-6" style="min-height: 365px;">
                         <div class="text-center p-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando gráfico 6...</span>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (async () => {
        const initCharts = async () => {
            try {
                // Aguarda ApexCharts com Promise global + timeout extra
                await window.apexChartsLoaded;
                 await new Promise(resolve => setTimeout(resolve, 500));  // Aumentado para 500ms
                if (typeof ApexCharts === 'undefined') {
                    throw new Error('ApexCharts ainda não carregado após retry');
                }

                const renderChart = (chartId, chartData) => {
                    const chartDiv = document.querySelector(chartId);
                    if (!chartDiv) {
                        console.error(`Elemento ${chartId} não encontrado.`);
                        return;
                    }
                    console.log(`Renderizando ${chartId}:`, chartData);
                    // Validação mais leniente (aceita se tem series e data)
                    let isValid = chartData && typeof chartData === 'object' && chartData.series && Array.isArray(chartData.series);
                    if (!isValid || chartData.error) {
                        console.warn(`Dados inválidos para ${chartId}:`, chartData);
                        chartDiv.innerHTML = `<div class='alert alert-warning small p-2 text-center'>${chartData?.error || 'Gráfico indisponível'}</div>`;
                        return;
                    }
                    try {
                        const chart = new ApexCharts(chartDiv, chartData);
                        chart.render();
                        console.log(`✓ ${chartId} renderizado.`);
                    } catch (e) {
                        console.error(`Erro no ${chartId}:`, e);
                        chartDiv.innerHTML = '<div class=\"alert alert-danger small p-2 text-center\">Erro no gráfico. Verifique console.</div>';
                    }
                };
                // Render com delays progressivos
                renderChart('#chart-eda-1', {{ charts.chart1 | tojson | safe }});
                setTimeout(() => renderChart('#chart-eda-2', {{ charts.chart2 | tojson | safe }}), 200);
                setTimeout(() => renderChart('#chart-eda-3', {{ charts.chart3 | tojson | safe }}), 400);
                setTimeout(() => renderChart('#chart-eda-4', {{ charts.chart4 | tojson | safe }}), 600);
                setTimeout(() => renderChart('#chart-eda-5', {{ charts.chart5 | tojson | safe }}), 800);
                setTimeout(() => renderChart('#chart-eda-6', {{ charts.chart6 | tojson | safe }}), 1000);
            } catch (e) {
                console.error('Falha geral nos gráficos EDA:', e);
                document.querySelectorAll('[id^=chart-eda-]').forEach(div => {
                    div.innerHTML = '<div class=\"alert alert-danger small p-2 text-center\">Erro: ApexCharts não disponível.</div>';
                });
            }
        };
        initCharts();
    })();
</script>